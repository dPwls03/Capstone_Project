# ✅ 6주차: 프론트엔드 구축 및 개발

## Next.js & pnpm 설치 및 프로젝트 실행

> 🔗 참고 자료  
- [next.js](https://nextjs.org/) 
- [pnpm](https://pnpm.io/ko/installation)

> Frontend Next.js 새 프로젝트 만들기

```bash
npx create-next-app@latest
```

> pnpm 설치하기

```bash
npm install -g pnpm@latest-10
```

> 프로젝트 서버 실행

```bash
npm run dev
```

## 화재 감지 프론트엔드 구축

> 🔗 참고 자료
- [TanStack Query](https://tanstack.com/query/latest/docs/framework/react/installation)

> TanStack Query 설치하기

```bash
pnpm add @tanstack/react-query
```

> Provider.tsx 파일 생성

```bash
'use client'

import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { useState } from 'react'

export default function Providers({ children }: { children: React.ReactNode }) {
    const [queryClient] = useState(() => new QueryClient())

    return (
        <QueryClientProvider client={queryClient}>
            {children}
        </QueryClientProvider>
    )
}
```

> layout.tsx 수정

```bash
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import Providers from "./providers";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {


  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <Providers>
          {children}
        </Providers>
      </body>
    </html>
  );
}
```

> 프로젝트 실행

```bash
pnpm run dev
```

## 실시간 화재 감지를 위한 오디오 및 경고 시스템 구현

> 화재 감지 시 알람, 배경 효과주기

tailwind.config.ts

```bash
import type { Config } from "tailwindcss";

export default {
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      colors: {
        background: "var(--background)",
        foreground: "var(--foreground)",
      },
      keyframes: {
        slideIn: {
          from: { transform: 'translateX(100%)', opacity: '0' },
          to: { transform: 'translateX(0)', opacity: '1' },
        },
        slideOut: {
          from: { transform: 'translateX(0)', opacity: '1' },
          to: { transform: 'translateX(100%)', opacity: '0' },
        },
        pulse: {
          '0%, 100%': { backgroundColor: 'rgba(239, 68, 68, 0.9)' },
          '50%': { backgroundColor: 'rgba(220, 38, 38, 0.9)' },
        },
        flashBorder: {
          '0%, 100%': { 
            boxShadow: '0 0 0 0 rgba(239, 68, 68, 0)' 
          },
          '50%': { 
            boxShadow: '0 0 0 6px rgba(239, 68, 68, 0.5)' 
          }
        },
        screenFlash: {
          '0%, 100%': { 
            boxShadow: 'inset 0 0 0 0 rgba(239, 68, 68, 0)' 
          },
          '50%': { 
            boxShadow: 'inset 0 0 100px 0 rgba(239, 68, 68, 0.3)' 
          }
        }
      },
      animation: {
        slideIn: 'slideIn 0.5s ease-out forwards',
        slideOut: 'slideOut 0.5s ease-out forwards',
        pulse: 'pulse 2s ease-in-out infinite',
        flashBorder: 'flashBorder 2s ease-in-out infinite',
        screenFlash: 'screenFlash 2s ease-in-out infinite'
      },
    },
  },
  plugins: [],
} satisfies Config;
```

> 오디오 권한, 경고음 생성 및 재생 코드

page.tsx

```bash
const initAudioContext = async () => {
    try {
      if (!audioPermission) {
        const userConsent = window.confirm("화재 경보에는 오디오 권한이 필요합니다. 허용하시겠습니까?");
        if (!userConsent) {
          return false;
        }

        const AudioContext = window.AudioContext || (window as any).webkitAudioContext;
        audioContextRef.current = new AudioContext();

        // iOS Safari
        if (audioContextRef.current.state === 'suspended') {
          await audioContextRef.current.resume();
        }

        setAudioPermission(true);
        return true;
      }
      return true;
    } catch (error) {
      console.error("audio initialization error:", error);
      alert("audio initialization failed.");
      return false;
    }
  };

  // 경고음 멈추기
  const stopAlertSound = () => {
    if (sourceNodeRef.current) {
        sourceNodeRef.current.stop();
        sourceNodeRef.current.disconnect();
    }
    if (gainNodeRef.current) {
        gainNodeRef.current.disconnect();
    }
  };

  // 경고음 생성 및 재생
  const playAlertSound = () => {
    if (!audioContextRef.current) return;
    stopAlertSound();

    const oscillator = audioContextRef.current.createOscillator();
    gainNodeRef.current = audioContextRef.current.createGain();

    oscillator.type = 'sawtooth';
    oscillator.frequency.setValueAtTime(440, audioContextRef.current.currentTime);

    // frequency modulation
    oscillator.frequency.setValueAtTime(440, audioContextRef.current.currentTime);
    oscillator.frequency.linearRampToValueAtTime(880, audioContextRef.current.currentTime + 0.5);
    oscillator.frequency.linearRampToValueAtTime(440, audioContextRef.current.currentTime + 1);

    // volume adjustment
    gainNodeRef.current.gain.setValueAtTime(0.5, audioContextRef.current.currentTime);

    oscillator.connect(gainNodeRef.current);
    gainNodeRef.current.connect(audioContextRef.current.destination);

    oscillator.start();
    sourceNodeRef.current = oscillator; //OscillatorNode로 할당
  };
```

## 화재 감지 로그의 반응형 웹 구현

> 감지 로그 데이터 가져오기

detectionLogs/page.tsx

```bash
  const getDetectionLogs = async ({
    page,
    pageSize,
  }: {
    page: number
    pageSize: number
  }) => {
    const response = await fetch(
      `http://localhost:8000/get_detection_log?page=${page}&page_size=${pageSize}`,
    )
    return response.json()
  }

  const { data: getDetectionLogsData } = useQuery({
    queryKey: ['get_detection_log', page, pageSize],
    queryFn: () => getDetectionLogs({ page, pageSize }),
  })
```
